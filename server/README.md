# Ballerina Project – Income/Expense API

A simple Ballerina HTTP service that supports basic auth plus CRUD-like operations for incomes and expenses stored in-memory. CORS is enabled for http://localhost:3000.

- Org/Name: `janishkamadushan/ballerina_project`
- Version: `0.1.0`
- Ballerina distribution: `2201.12.7`
- Default port: `9092`

## Prerequisites

- Ballerina Swan Lake 2201.12.7 (or newer in the 2201.12.x line)
  - macOS: `brew install ballerina` (or download from ballerina.io)
- macOS/Linux/Windows terminal

Optional (for trying the included HTTP file):
- VS Code with the "REST Client" extension to run `client.rest` directly.

## Getting started

1) Clone and open the workspace, then go to the server module directory:

```bash
cd /Users/janishkamadushan/Documents/University/Projects/ballerina-project/server
```

2) Run in dev mode (restarts on file changes):

```bash
bal run --watch
```

Or run once:

```bash
bal run
```

3) Build an executable (JAR) artifact:

```bash
bal build
```

The JAR will be created at `target/bin/ballerina_project.jar`.

## API overview

Base URL: `http://localhost:9092`

Seed users (in-memory):
- Alice — email: `alice@example.com`, password: `password123`, id: `1`
- Bob — email: `bob@example.com`, password: `password456`, id: `2`

Token model: After a successful login, the token is `SECRET_KEY + userId` where `SECRET_KEY = 9878787`.

### Auth
- POST `/auth`
  - Body: `{ "email": string, "password": string }`
  - 200 response: `{ "token": string, "code": 200, "message": "Authentication successful" }`

Example:
```bash
curl -sS -X POST http://localhost:9092/auth \
  -H 'Content-Type: application/json' \
  -d '{
    "email": "alice@example.com",
    "password": "password123"
  }'
```

Note: The returned `token` value is a string representation of an integer. The other endpoints expect the token as an integer; pass it without quotes (see examples below).

### Income endpoints
- POST `/income/add`
  - Body: `{ "token": int, "amount": float, "date": {"year": int, "month": int, "day": int}, "name": string }`
  - 200: `{ "message": "Income added successfully", "code": 200 }`

```bash
curl -sS -X POST http://localhost:9092/income/add \
  -H 'Content-Type: application/json' \
  -d '{
    "token": 9878788,
    "amount": 5000,
    "date": {"year": 2025, "month": 8, "day": 18},
    "name": "Salary"
  }'
```

- GET `/income/all?token=<int>`
  - 200: `Income[]` for the authenticated user

```bash
curl -sS "http://localhost:9092/income/all?token=9878788"
```

- DELETE `/income/remove`
  - Body: `{ "token": int, "id": int }`
  - 200: `{ "message": "Income removed successfully", "code": 200 }`

```bash
curl -sS -X DELETE http://localhost:9092/income/remove \
  -H 'Content-Type: application/json' \
  -d '{
    "id": 1,
    "token": 9878788
  }'
```

### Expense endpoints
- POST `/expense/add`
  - Body: `{ "token": int, "amount": float, "date": {"year": int, "month": int, "day": int}, "name": string }`
  - 200: `{ "message": "Expense added successfully", "code": 200 }`

```bash
curl -sS -X POST http://localhost:9092/expense/add \
  -H 'Content-Type: application/json' \
  -d '{
    "token": 9878788,
    "amount": 250,
    "date": {"year": 2025, "month": 8, "day": 18},
    "name": "Groceries"
  }'
```

- GET `/expense/all?token=<int>`

```bash
curl -sS "http://localhost:9092/expense/all?token=9878788"
```

- DELETE `/expense/remove`
  - Body: `{ "token": int, "id": int }`

```bash
curl -sS -X DELETE http://localhost:9092/expense/remove \
  -H 'Content-Type: application/json' \
  -d '{
    "id": 1,
    "token": 9878788
  }'
```

## Using the provided HTTP file

You can run all the example requests from `client.rest`.
- In VS Code, install the REST Client extension.
- Open `client.rest` and click "Send Request" above each request block.

## CORS

CORS is configured to allow requests from `http://localhost:3000` and methods `GET, POST, DELETE, OPTIONS` with headers `Content-Type, CORELATION_ID`.

## Observability (optional)

Observability is included in build options. You can enable default metrics/tracing when running locally if needed. Refer to Ballerina docs for `--observe` and related flags.

## Project structure

```
server/
├─ Ballerina.toml
├─ Dependencies.toml        # auto-generated by Ballerina
├─ main.bal                 # service implementation
├─ client.rest              # sample requests for quick testing
└─ target/                  # build output (ignored by Git)
```

## Troubleshooting

- Port already in use: Change the listener port in `main.bal` (9092) or stop the other process.
- Version mismatch: Ensure your local Ballerina version matches `distribution = "2201.12.7"` from `Ballerina.toml`.
- Clean build: If something looks stale, remove `target/` and run `bal build` again.

## License

This project is provided as-is by the author. Add a LICENSE file if you plan to distribute.
